<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projects/Open Source/Banshee/MTP/Old/Instructions20061209 | Patrick van Staveren</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Projects/Open Source/Banshee/MTP/Old/Instructions20061209" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Just a few more bytes on the Internet." />
<meta property="og:description" content="Just a few more bytes on the Internet." />
<link rel="canonical" href="http://trick.vanstaveren.us/wiki/Projects/Open_Source/Banshee/MTP/Old/Instructions20061209/" />
<meta property="og:url" content="http://trick.vanstaveren.us/wiki/Projects/Open_Source/Banshee/MTP/Old/Instructions20061209/" />
<meta property="og:site_name" content="Patrick van Staveren" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Projects/Open Source/Banshee/MTP/Old/Instructions20061209" />
<script type="application/ld+json">
{"headline":"Projects/Open Source/Banshee/MTP/Old/Instructions20061209","dateModified":"2006-12-09T13:24:19-06:00","description":"Just a few more bytes on the Internet.","@type":"WebPage","url":"http://trick.vanstaveren.us/wiki/Projects/Open_Source/Banshee/MTP/Old/Instructions20061209/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://trick.vanstaveren.us/feed.xml" title="Patrick van Staveren" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">Patrick van Staveren</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <a class="page-link" href="/Contact/">Contact</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          <a class="page-link" href="/wp/">Web Log</a>
        </div>
      </nav>
    
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="page">
  <ul class="tag_list_in_post">
    
  </ul>
  <h1 class="page-title">Projects/Open Source/Banshee/MTP/Old/Instructions20061209</h1>
  <p><a href="/wiki/Projects/Open_Source/Banshee/MTP/Compatibility" title="wikilink">Compatibility</a>
| <a href="/wiki/Projects/Open_Source/Banshee/MTP/FAQ" title="wikilink">FAQ</a> |
<a href="/wiki/Projects/Open_Source/Banshee/MTP/Icons" title="wikilink">Icons</a> | <a href="/wiki/Projects/Open_Source/Banshee/MTP/Known_Bugs" title="wikilink">Known
Bugs</a> |
<a href="/wiki/Projects/Open_Source/Banshee/MTP/Patches" title="wikilink">Patches</a> |
<a href="/wiki/Projects/Open_Source/Banshee/MTP/Playlists" title="wikilink">Playlists</a> | <a href="/wiki/Projects/Open_Source/Banshee/MTP/To_Do" title="wikilink">To
Do</a></p>

<h2 id="about-mtp">About MTP</h2>

<p>Check out the <a href="http://en.wikipedia.org/wiki/Media_Transfer_Protocol">Media Transfer
Protocol</a> page on
<a href="http://www.wikipedia.org">Wikipedia</a>.</p>

<p>MTP stands for the Media Transfer Protocol. While it is a standard
created and used almost solely by Microsoft, it is becoming a popular
interface for newer Digital Audio Players. Seeing this growth in MTP
players, the need for an open-source implementation became necessary.
Thus, a handful of projects were born to try to communicate with these
devices. libgphoto2 made some pokes &amp; prods at MTP devices, and the
libmtp project was established by some of the libnjb/gnomad2 developers
in the desire to support these newer devices. Since then, libmtp and
libgphoto2 have joined forces and collaborated to help each other out.
As of right now, they are basically the same base of code with two
different interfaces, and were originally forked from the same base of
code (libptp2).</p>

<p>Banshee.Dap.Mtp uses <a href="http://www.gphoto.org">libgphoto2</a>.</p>

<h2 id="supported-devices">Supported Devices</h2>

<p>Check out the
<a href="/wiki/Projects/Open_Source/Banshee/MTP/Compatibility" title="wikilink">compatibility</a>
page. <a href="/wiki/Contact" title="wikilink">Contact</a> me if there are changes to be made
to this list!</p>

<h2 id="how-to-install">How to install</h2>

<p>Sometimes I keep some patches against Banshee CVS for MTP. If so, you
can find them on the <a href="/wiki/Projects/Open_Source/Banshee/MTP/Patches" title="wikilink">MTP
Patches</a> page.</p>

<h3 id="remove-old-packages">Remove old packages</h3>

<p>First, be sure that you have removed any distribution packaged software
such as libgphoto2, gphoto2, and banshee. If you fail to do this, the
installation will most likely have problems.</p>

<h3 id="packages-to-have--prerequisites">Packages to have / Prerequisites</h3>

<p>Please be sure that you have all companion -dev/-devel packages
installed. Configure scripts will fail if you are missing them - and
they will act like you are missing the library itself.</p>

<ul>
  <li>Mono and all it’s devel packages.
    <ul>
      <li>Ubuntu Dapper:
        <ul>
          <li>libmono0</li>
          <li>libmono-dev</li>
          <li>mono</li>
          <li>mono-common</li>
          <li>mono-devel</li>
          <li>mono-mcs</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>libltdl
    <ul>
      <li>libltdl</li>
      <li>libltdl-dev</li>
    </ul>
  </li>
  <li>libusb - BE WARNED: libusb 0.1.12 is KNOWN to cause troubles. Use
libusb 0.1.11 wherever possible
    <ul>
      <li>libusb</li>
      <li>libusb-dev</li>
    </ul>
  </li>
  <li>libexif
    <ul>
      <li>libexif</li>
      <li>libexif-dev</li>
    </ul>
  </li>
</ul>

<h3 id="grabbing-the-latest-libgphoto2">Grabbing the latest libgphoto2</h3>

<p>libgphoto2-sharp is now installed directly out of the libgphoto2
subversion tree. In the future (2.2.2 hopefully) libgphoto2 will
distribute with the -sharp binding, but for now you will need to work
with a svn version.</p>

<p>Snag yourself a copy of libgphoto2 from subversion:</p>

<p><code class="language-plaintext highlighter-rouge">  svn co </code><a href="https://svn.sourceforge.net/svnroot/gphoto/trunk/libgphoto2"><code class="language-plaintext highlighter-rouge">https://svn.sourceforge.net/svnroot/gphoto/trunk/libgphoto2</code></a></p>

<p>and build it, like normal:</p>

<p><code class="language-plaintext highlighter-rouge"> ./autogen.sh</code></p>

<p>If you get an error like
<a href="/wiki/Projects/Open_Source/Banshee/MTP/FAQ#Q:_What_does_this_mess_mean_when_I_run_autogen.sh_in_libgphoto2.3F" title="wikilink">this</a>,
be sure to have libltdl installed.</p>

<p><code class="language-plaintext highlighter-rouge"> ./configure</code></p>

<p>Watch the output of ./configure to make sure that the csharp bindings
are enabled. It should have a line in it something like:</p>

<p><code class="language-plaintext highlighter-rouge"> Bindings:             csharp</code></p>

<p>then, just do the usual:</p>

<p><code class="language-plaintext highlighter-rouge"> make &amp;&amp; sudo make install &amp;&amp; sudo ldconfig</code></p>

<p>To get around an ugly bug that we have with libgphoto2_port’s disk
driver, be sure to remove it:</p>

<p><code class="language-plaintext highlighter-rouge"> sudo rm /usr/local/lib/libgphoto2_port/0.6.1/disk.*</code></p>

<p>Libgphoto2 and it’s C# bindings should now be installed!</p>

<h3 id="installing-gphoto2-to-test-libgphoto2">Installing gphoto2 to test libgphoto2</h3>

<p>The <code class="language-plaintext highlighter-rouge">gphoto2</code> command line tool is the easiest way to test that
libgphoto2 can find and access your MTP device. It’s contained in the
gphoto svn repository. You know the drill – grab and install it as
follows:</p>

<p><code class="language-plaintext highlighter-rouge"> svn co </code><a href="https://svn.sourceforge.net/svnroot/gphoto/trunk/gphoto2"><code class="language-plaintext highlighter-rouge">https://svn.sourceforge.net/svnroot/gphoto/trunk/gphoto2</code></a><br />
<code class="language-plaintext highlighter-rouge"> cd gphoto2</code><br />
<code class="language-plaintext highlighter-rouge"> ./autogen.sh</code><br />
<code class="language-plaintext highlighter-rouge"> ./configure</code><br />
<code class="language-plaintext highlighter-rouge"> make</code><br />
<code class="language-plaintext highlighter-rouge"> sudo make install</code></p>

<p>Once it’s installed, test to see if gphoto2 can find your MTP device:</p>

<p><code class="language-plaintext highlighter-rouge"> gphoto2 -L</code></p>

<p>It should list all the files &amp; folders on your device. If you get any
errors as this point, you can safely assume that you will have trouble
and that the Banshee DAP interface will not be happy. Regardless, you
can trudge on!</p>

<p>If you have any issues at this point, post a debug output to
<a href="http://www.pastebin.us">pastebin.us</a> and hit up irc.gnome.org/#banshee
and ask trick for help. Optionally, if it looks more like an issue with
the MTP (PTP2) driver, you can ask on irc.freenode.net/#gphoto, but ask
nicely as this driver is new and the developers are busy folks.</p>

<p>If it’s working great, lets try it in Banshee!</p>

<h4 id="optional-halhotplug-info-files-install">OPTIONAL: HAL/hotplug info files install</h4>

<p>Please <strong>take note</strong>: <strong>I HAVE NOT TESTED ANY OF THIS. IT IS PROVIDED
ONLY FOR REFERENCE IN DESPERATE SITUATIONS.</strong> You Have Been Warned! If
you break your hotplug or HAL from this and are now reading this
statement for the first time, take it as a lesson in life: READ the
documentation, and then run whatever crazy command (or in
Hollywood-speak, ask questions FIRST and shoot SECOND)</p>

<p><strong>SYMPTOM:</strong> <code class="language-plaintext highlighter-rouge">gphoto2 -L</code> returns “Permission denied”, “Could not grab
device”, “Operation not permitted”, or a similar seemingly permissions
related error. <code class="language-plaintext highlighter-rouge">gphoto2</code> and <code class="language-plaintext highlighter-rouge">Banshee</code> and MTP support works as root,
but not as a regular user.</p>

<p><strong>INFO:</strong> If you’re trying to get gphoto2 from the command line to work,
or Banshee is giving you permissions errors, these commands might help.
They are meant only for users who understand (somewhat) what they do and
know that this is necessary. It’s possible to cheat at this - before you
install libgphoto2 from svn, just install libgphoto2 from your
distribution and uninstall it. It might leave these files behind as they
are not troublesome, and you’ll be all set. On Gentoo, when you remove a
package, it does not uninstall entries in /etc so I’ve never had to run
any of these commands by hand.</p>

<p>These commands were taken directly from the gentoo ebuild for 2.2.1-r1.
Note that your prefix (/usr versus /usr/local) and your libdir (lib
versus lib64 on x86_64) may need to be swapped in. Also, please verify
that these installation paths fit with the various packages on your
distribution! Certain things may need to go to another location and I
can’t figure them out for you :)</p>

<p><strong>SOLUTION:</strong> <strong>Install the hotplug usbcam script.</strong> (from within the
libgphoto2 checkout directory)</p>

<p><code class="language-plaintext highlighter-rouge">{vim|pico|emacs|gedit|whatever} packaging/linux-hotplug/usbcam.group</code><br />
<code class="language-plaintext highlighter-rouge"># be sure the GROUP variable is set to a group that you are a member of.</code><br />
<code class="language-plaintext highlighter-rouge"># Traditionally I think this is left as camera, but your distribution may very.</code><br />
<code class="language-plaintext highlighter-rouge">cp packaging/linux-hotplug/usbcam.group /etc/hotplug/usb/usbcam</code><br />
<code class="language-plaintext highlighter-rouge">chmod +x /etc/hotplug/usb/usbcam</code></p>

<p><strong>Install the USB hotplug system’s userspace mapping.</strong></p>

<p><code class="language-plaintext highlighter-rouge">export HOTPLUG_USERMAP=</code>“<code class="language-plaintext highlighter-rouge">/etc/hotplug/usb/usbcam-gphoto2.usermap</code>”<br />
<code class="language-plaintext highlighter-rouge">/usr/lib/libgphoto2/print-camera-list usb-usermap &gt; $HOTPLUG_USERMAP</code></p>

<p><strong>Install the HAL FDI entries.</strong></p>

<p><code class="language-plaintext highlighter-rouge">export HAL_FDI=</code>“<code class="language-plaintext highlighter-rouge">/usr/share/hal/fdi/information/10freedesktop/10-camera-libgphoto2.fdi</code>”<br />
<code class="language-plaintext highlighter-rouge">/usr/local/lib/libgphoto2/print-camera-list hal-fdi &gt; $HAL_FDI</code></p>

<p><strong>Finally, be sure to restart hotplug and HAL to make these changes take
effect</strong>. I don’t know if they do automatically. If you’re not sure how
to do this or what I’m talking about, just do a reboot.</p>

<h3 id="installing-banshee-from-cvs">Installing Banshee from CVS</h3>

<p>Grab the latest CVS version of Banshee:</p>

<p><code class="language-plaintext highlighter-rouge"> cvs -z3 -d:pserver:anonymous@anoncvs.gnome.org:/cvs/gnome co -P banshee</code></p>

<p><strong>NOTE: this will change as Gnome is moving to Subversion
(eventually).</strong> If you’re getting errors with this command, check out
the <a href="http://live.gnome.org/Subversion">status of the subversion
migration</a>. Ask in #banshee or
#gnome for help!</p>

<p>Finally, run autogen. Pass <code class="language-plaintext highlighter-rouge">--enable-mtp</code>:</p>

<p><code class="language-plaintext highlighter-rouge"> ./autogen.sh --enable-mtp --whatever-other-flags-you-usually-use</code></p>

<p>If you’ve never built Banshee from source before, and are using a
standard gstreamer installation…use:</p>

<p><code class="language-plaintext highlighter-rouge"> ./autogen.sh --enable-mtp</code></p>

<p>That should do the trick. Finally, make Banshee and install it:</p>

<p><code class="language-plaintext highlighter-rouge"> make &amp;&amp; sudo make install</code></p>

<h2 id="moving-further">Moving further</h2>

<h3 id="testing-it-out">Testing it out</h3>

<p>First, check out the <a href="/wiki/Projects/Open_Source/Banshee/MTP/Known_Bugs" title="wikilink">Known
Bugs</a> page.
PLEASE, read this page!</p>

<p>It’s not that hard to run Banshee. Execute banshee (preferrably from a
terminal, with the <strong>–debug</strong> flag, in case you get an error).</p>

<p>Once Banshee has started up, plug your MTP device in. As long as all is
well, the interface will show a little loading message as it reads the
track information from the device. Once the message disappears, you
should be ready to go! Drag ‘n drop some tracks on the device, and run a
Synchronize to see if it works. Not only can you drag mp3’s, but also
ogg and flac (and possibly even other formats) to the device and they
will be transcoded and then transferred to the device. In my experience
this has been flawless.</p>

<p>Removing tracks from the device is easy. Just right click the file and
hit Remove, and then run Synchronize.</p>

<p>Editing of Metadata is possible, but has been disabled because of some
strange conflicts and crashes with the CVS updates. This will most
likely be sorted out in the future.</p>

<p>Playback does not work at all. It might someday, but not for now.</p>

<h3 id="playlists">Playlists</h3>

<p>Playlists don’t work. Not yet. But, they’re in the
works…<a href="/wiki/Projects/Open_Source/Banshee/MTP/Playlists" title="wikilink">playlist</a>
support is coming…</p>

<h3 id="reporting-bugs">Reporting Bugs</h3>

<p>Please, by all means, report bugs. There are so many possible bugs in
this code that I just won’t discover myself, and this can be a good
piece of software if you help me out. File bugs on the <a href="http://bugzilla.gnome.org/enter_bug.cgi?product=banshee&amp;component=MTP">Gnome Bugzilla,
product banshee, component
MTP</a>.</p>

<h3 id="sending-patches">Sending Patches</h3>

<p>As with reporting bugs, patches are more than welcome. I’ve been
experiencing a few troubles, particularly with shutting down banshee
after making a transfer. I’m pretty sure that they’re native-code
related, but I have no clue where (as of yet). Please post patches to
bugzilla!</p>

<p>Also, check out <a href="/wiki/Projects/Open_Source/Banshee/MTP/Known_Bugs" title="wikilink">Known
Bugs</a> and the
<a href="/wiki/Projects/Open_Source/Banshee/MTP/To_Do" title="wikilink">To Do</a> list.</p>

<h3 id="icons">Icons</h3>

<p>I’m working on some icons
<a href="/wiki/Projects/Open_Source/Banshee/MTP/Icons" title="wikilink">here</a>.</p>

</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            Patrick van Staveren
            </li>
            
            <li><a class="u-email" href="mailto:trick@vanstaveren.us">trick@vanstaveren.us</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list"></ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>Just a few more bytes on the Internet.</p>
        <p>Last Modified: 2006-12-09 13:24:19 -0600</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
